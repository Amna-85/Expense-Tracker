<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My Expenses - Expense Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .navbar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stats-card { background: white; border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.1); margin-bottom: 20px; border-left: 4px solid #667eea; }
        .stats-number { font-size: 1.8rem; font-weight: 700; color: #667eea; }
        .stats-label { color: #6c757d; font-size: 0.9rem; margin-top: 5px; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" th:href="@{/dashboard}"><i class="fas fa-wallet me-2"></i>üí∞ Expense Tracker</a>
            <div class="navbar-nav ms-auto">
                <a th:href="@{/dashboard}" class="nav-link">üè† Dashboard</a>
                <a th:href="@{/expenses}" class="nav-link active">üìù Expenses</a>
                <a th:href="@{/analytics}" class="nav-link">üìä Analytics</a>
                <span class="navbar-text me-3">Welcome, <span th:text="${user.firstName}"></span></span>
                <a th:href="@{/users/logout}" class="nav-link">üö™ Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="mb-1">üìù My Expenses</h2>
                <p class="text-muted mb-0">Manage and track all your expenses in one place</p>
            </div>
            <a th:href="@{/expenses/add}" class="btn btn-primary btn-lg">
                <i class="fas fa-plus me-2"></i>Add New Expense
            </a>
        </div>

        <!-- Simple Statistics Section -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="totalExpenses">0</div>
                    <div class="stats-label">Total Expenses</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number">$<span id="totalAmount">0.00</span></div>
                    <div class="stats-label">Total Amount</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="totalCategories">0</div>
                    <div class="stats-label">Categories</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number">$<span id="averageExpense">0.00</span></div>
                    <div class="stats-label">Average/Expense</div>
                </div>
            </div>
        </div>

        <!-- Expenses Table -->
        <div th:if="${expenses.empty}" class="card text-center py-5">
            <i class="fas fa-receipt fa-4x text-muted mb-3"></i>
            <h4 class="text-muted">No expenses yet</h4>
            <p class="text-muted">Start tracking your expenses by adding your first one!</p>
            <a th:href="@{/expenses/add}" class="btn btn-primary mt-2">Add Your First Expense</a>
        </div>

        <div th:unless="${expenses.empty}" class="card">
            <div class="card-header"><h5 class="mb-0">All Expenses</h5></div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped" id="expensesTable">
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="expense : ${expenses}">
                                <td th:text="${expense.description}"></td>
                                <td class="expense-category" th:text="${expense.category}"></td>
                                <td class="expense-amount" th:text="'$' + ${#numbers.formatDecimal(expense.amount, 1, 2)}"></td>
                                <td>
                                    <a th:href="@{/expenses/delete/{id}(id=${expense.id})}" class="btn btn-danger btn-sm"
                                       onclick="return confirm('Delete this expense?')">
                                        Delete
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mt-4">
            <div class="col-12 text-center">
                <a th:href="@{/expenses/add}" class="btn btn-primary me-3">
                    <i class="fas fa-plus me-2"></i>Add Another Expense
                </a>
                <a th:href="@{/analytics}" class="btn btn-outline-primary me-3">
                    <i class="fas fa-chart-pie me-2"></i>View Analytics
                </a>
                <a th:href="@{/dashboard}" class="btn btn-outline-secondary">
                    <i class="fas fa-home me-2"></i>Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            calculateTotals();
        });

        function calculateTotals() {
            // Get all table rows (excluding header)
            const tableRows = document.querySelectorAll('#expensesTable tbody tr');
            
            if (tableRows.length === 0) return;
            
            let totalAmount = 0;
            const categories = new Set();
            
            console.log('Found rows:', tableRows.length);
            
            // Calculate total amount and collect categories
            tableRows.forEach(row => {
                // Get amount from the third cell (index 2)
                const amountCell = row.cells[2];
                const amountText = amountCell.textContent.replace('$', '');
                const amount = parseFloat(amountText) || 0;
                totalAmount += amount;
                
                // Get category from the second cell (index 1)
                const categoryCell = row.cells[1];
                const category = categoryCell.textContent.trim();
                categories.add(category);
                
                console.log('Expense:', category, '$' + amount);
            });
            
            // Calculate average
            const averageExpense = totalAmount / tableRows.length;
            
            // Update the statistics
            document.getElementById('totalExpenses').textContent = tableRows.length;
            document.getElementById('totalAmount').textContent = totalAmount.toFixed(2);
            document.getElementById('totalCategories').textContent = categories.size;
            document.getElementById('averageExpense').textContent = averageExpense.toFixed(2);
            
            console.log('Calculated totals:');
            console.log('Total Expenses:', tableRows.length);
            console.log('Total Amount:', totalAmount.toFixed(2));
            console.log('Categories:', categories.size);
            console.log('Average:', averageExpense.toFixed(2));
            console.log('Category list:', Array.from(categories));
        }
    </script>
</body>
</html>